<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Android轻量级数据存储类SharedPreferences详解</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Byronlee</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Android轻量级数据存储类SharedPreferences详解</h2>
<p class="meta">01 Sep 2012</p>

<div class="post">
<h3><span style="color: #ff0000;">SharedPreferences 是什么：</span></h3>

<p>SharedPreferences是Android中存储简单数据的一个工具类。可以想象它是一个小小的Cookie，它通过用键值对的方式把简单数据类型（boolean、int、float、long和String）存储在应用程序的私有目录下(data/data/包名/shared_prefs/)自己定义的xml文件中。</p>

<p>它提供一种轻量级的数据存储方式，通过eidt()方法来修改里面的内容，通过Commit()方法来提交修改后的内容。</p>

<p>做软件开发应该都知道，很多软件会有配置文件，里面存放这程序运行当中的各个属性值，由于其配置信息并不多，如果采用数据库来存放并不划算，因为数据库连接跟操作等耗时大大影响了程序的效率，因此我们使用键值这种一一对应的关系来存放这些配置信息。SharedPreferences正是Android中用于实现这中存储方式的技术。</p>

<p>SharedPreferences的使用非常简单，能够轻松的存放数据和读取数据。SharedPreferences只能保存简单类型的数据，例如，String、int等。一般会将复杂类型的数据转换成Base64编码，然后将转换后的数据以字符串的形式保存在 XML文件中，再用SharedPreferences保存。</p>

<p><span style="color: #ff0000;">重要方法：</span></p>

<p>&nbsp;</p>

<p>public abstract boolean contains (String key) ：检查是否已存在该文件，其中key是xml的文件名。</p>

<p>edit()：为preferences创建一个编辑器Editor,通过创建的Editor可以修改preferences里面的数据，但必须执行commit()方法。</p>

<p>getAll()：返回preferences里面的多有数据。</p>

<p>getBoolean(String key, boolean defValue)：获取Boolean型数据</p>

<p>getFloat(String key, float defValue)：获取Float型数据</p>

<p>getInt(String key, int defValue)：获取Int型数据</p>

<p>getLong(String key, long defValue)：获取Long型数据</p>

<p>getString(String key, String defValue)：获取String型数据</p>

<p>registerOnSharedPreferenceChangeListener(SharedPreferences.OnSharedPreferenceChangeListener listener)：注册一个当preference发生改变时被调用的回调函数。</p>

<p>unregisterOnSharedPreferenceChangeListener(SharedPreferences.OnSharedPreferenceChangeListener listener)：删除当前回调函数。</p>

<p><strong><br />
</strong></p>

<p><strong>重要方法</strong></p>

<p>clear()：清除内容。</p>

<p>commit()：提交修改</p>

<p>remove(String key)：删除preference</p>

<p>&nbsp;</p>

<p><span style="color: #ff0000;">使用SharedPreferences保存key-value对的步骤如下：</span></p>

<p>（1）使用Activity类的getSharedPreferences方法获得SharedPreferences对象，其中存储key-value的文件的名称由getSharedPreferences方法的第一个参数指定。</p>

<p>（2）使用SharedPreferences接口的edit获得SharedPreferences.Editor对象。</p>

<p>（3）通过SharedPreferences.Editor接口的putXxx方法保存key-value对。其中Xxx表示不同的数据类型。例如：字符串类型的value需要用putString方法。</p>

<p>（4）通过SharedPreferences.Editor接口的commit方法保存key-value对。commit方法相当于数据库事务中的提交（commit）操作。</p>

<p><wbr></wbr></p>

<p><span style="color: #ff0000;">具体代码的书写流程为：</span></p>

<p><wbr></wbr></p>

<p><span style="color: #ff0000;">A、存放数据信息</span></p>

<p>1、打开Preferences，名称为setting，如果存在则打开它，否则创建新的Preferences</p>

<blockquote><p>SharedPreferences settings = getSharedPreferences(“setting”, 0);</p>
<p>// 这个地方对参数好好的介绍一下：</p>
<h4>public <a href="file:///D:/Program%20Files/android/docs/reference/android/content/SharedPreferences.html">SharedPreferences</a> getSharedPreferences(<a href="file:///D:/Program%20Files/android/docs/reference/java/lang/String.html">String</a> name, int mode)</h4>
<p>name：是指文件名称，不需要加后缀.xml，系统会自动为我们添加上。一般这个文件存储在<strong>/data/data/&lt;package name&gt;/shared_prefs</strong>下(这个面试常问到)</p>
<p>mode：是指定读写方式，其值有三种，分别为：</p>
<p><strong>Context.MODE_PRIVATE 或者0：</strong>指定该SharedPreferences数据只能被本应用程序读、写</p>
<p><strong>Context.MODE_WORLD_READABLE：</strong>指定该SharedPreferences数据能被其他应用程序读，但不能写</p>
<p><strong>Context.MODE_WORLD_WRITEABLE：</strong>指定该SharedPreferences数据能被其他应用程序读写。</p></blockquote>

<p>2、让setting处于编辑状态</p>

<blockquote><p>SharedPreferences.Editor editor = settings.edit();</p></blockquote>

<p>3、存放数据</p>

<blockquote><p>editor.putString(“name”,”ATAAW”);<br />
editor.putString(“URL”,”ATAAW.COM”);</p></blockquote>

<p>4、完成提交</p>

<blockquote><p>editor.commit();</p></blockquote>

<p>B、读取数据信息</p>

<p>1、获取Preferences</p>

<blockquote><p>SharedPreferences settings = getSharedPreferences(“setting”, 0);</p>
<p>&nbsp;</p></blockquote>

<p>2、取出数据</p>

<blockquote><p>String name = settings.getString(“name”,”默认值”);<br />
String url = setting.getString(“URL”,”default”);</p></blockquote>

<p>以上就是Android中SharedPreferences的使用方法，其中创建的Preferences文件存放位置可以在Eclipse中查看：</p>

<blockquote><p>DDMS-&gt;File Explorer /&lt;package name&gt;/shared_prefs/setting.xml</p></blockquote>

</div>


          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
